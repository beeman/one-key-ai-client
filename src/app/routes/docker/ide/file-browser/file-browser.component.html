<a #downloadElement style="visibility: hidden"></a>
<a #scanElement style="visibility: hidden"></a>

<div style="height: 100%;overflow: auto">
  <div nz-row style="padding: 8px">
    <div nz-col [nzSpan]="18">
      <nz-upload nzDirectory [nzCustomRequest]="uploadProjectReq" (nzChange)="uploadProjectChange($event)"
        [nzShowUploadList]="false">
        <button nz-button nzType="primary" [nzLoading]="projectUploading" [disabled]="projectUploading"><i nz-icon
            type="upload"></i>上传目录</button>
      </nz-upload>
      <nz-upload [nzCustomRequest]="uploadProjectReq" (nzChange)="uploadProjectChange($event)"
        [nzShowUploadList]="false">
        <button nz-button nzType="primary" [nzLoading]="projectUploading" [disabled]="projectUploading"
          style="margin-left: 8px"><i nz-icon type="upload"></i>上传文件</button>
      </nz-upload>
      <label style="margin-left: 8px">{{currentUploadingFile}}</label>
    </div>
    <div nz-col [nzSpan]="6" style="text-align: right">
      <button nz-button nzType="primary" (click)="updateProjects()"><i nz-icon type="sync"></i>刷新</button>
    </div>
  </div>

  <nz-tree id="tree" nzAsyncData [nzData]="fileList" (nzDblClick)="openFolder($event)"
    (nzExpandChange)="onExpandChange($event)">
    <ng-template #nzTreeTemplate let-node>
      <span *ngIf="!node.isLeaf" nz-dropdown [nzDropdownMenu]="folderMenu" (click)="activeNode(node)"
        [class.active]="activedNode?.key === node.key">
        <i nz-icon [type]="node.isExpanded ? 'folder-open' : 'folder'" (click)="openFolder(node)"></i>
        <span class="folder-name">{{ node.title }}</span>
      </span>
      <nz-dropdown-menu #folderMenu="nzDropdownMenu">
        <ul nz-menu nzInDropDown>
          <!-- <li nz-menu-item (click)="newFile()">新建文件</li>
          <li nz-menu-item (click)="newDir()">新建文件夹</li> -->
          <nz-upload [nzCustomRequest]="uploadReq" [nzShowUploadList]="false" (nzChange)="uploadChange($event)">
            <li nz-menu-item (click)="activeNode(node)">上传文件</li>
          </nz-upload>
          <br>
          <nz-upload nzDirectory [nzCustomRequest]="uploadReq" [nzShowUploadList]="false"
            (nzChange)="uploadChange($event)">
            <li nz-menu-item (click)="activeNode(node)">上传目录</li>
          </nz-upload>
          <li nz-menu-item (click)="showRemoveDirModal(node)">删除</li>
          <li nz-menu-item (click)="compress(node)">压缩至当前目录</li>
        </ul>
      </nz-dropdown-menu>

      <span nz-dropdown [nzDropdownMenu]="fileMenu" (click)="openFile(node)" *ngIf="node.isLeaf"
        (click)="activeNode(node)" [class.active]="activedNode?.key === node.key">
        <i nz-icon type="file"></i>
        <span class="file-name">{{ node.title }}</span>
      </span>
      <nz-dropdown-menu #fileMenu="nzDropdownMenu">
        <ul nz-menu nzInDropDown>
          <!-- <li nz-menu-item (click)="openFile()">打开</li>
          <li nz-menu-item (click)="saveFile()">保存</li> -->
          <li nz-menu-item (click)="openFile(node)">打开</li>
          <li nz-menu-item (click)="showRemoveFileModal(node)">删除</li>
          <li nz-menu-item (click)="downloadFile(node)">下载</li>
          <li nz-menu-item (click)="scan(node)">预览</li>
          <li nz-menu-item (click)="compress(node)" *ngIf="!canUncompress(node)">压缩至当前目录</li>
          <li nz-menu-item (click)="uncompress(node)" *ngIf="canUncompress(node)">解压至当前目录</li>
        </ul>
      </nz-dropdown-menu>
    </ng-template>
  </nz-tree>
</div>

<nz-modal [(nzVisible)]="modalInfo.alertModalVisible" [nzTitle]="modalInfo.modalTitle" (nzOnCancel)="onModalCancel()"
  (nzOnOk)="onModalConfirm()">
  <p>{{modalInfo.modalMessage}}</p>
</nz-modal>
